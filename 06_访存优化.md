# 访存优化

## Intro

在linux上测试将大小为1 << 27的vector所有元素设置为0比设置为了快了一倍,为什么捏

## 内存带宽

### cpu-bound 和 memory-bound

以上次的sin代码为例

```cpp
int main() {
    size_t n = 1<<26;
    std::vector<float> a(n);

    tbb::parallel_for(tbb::blocked_range<size_t>(0, n),
    [&] (tbb::blocked_range<size_t> r) {
        for (size_t i = r.begin(); i < r.end(); i++) {
            a[i] = std::sin(i);
        }
    });

    return 0;
}
```

通常来说,并行**能加速计算的部分,不能加速内存读写的部分**

* 对于需要泰勒展开计算,每次迭代计算量很大的sin代码 ,并行计算能有良好的效果,成为计算瓶颈

* 对于vector填充这种没有计算量,只有访存的循环体,并没有加速效果,称为**内存瓶颈**(memory-bound)

并行能减轻计算瓶颈,但是不能减轻内存瓶颈,所以后者是优化的重点

